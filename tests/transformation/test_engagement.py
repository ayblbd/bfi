import pandas as pd

from src.transformation.engagement import (
    build_credit,
    select_l2do_dcomm,
    select_l2do_dgen,
    select_l2do_dlanc,
    select_l2do_dpal,
    select_l2do_tfonc,
    select_l2hd_rbt_nat,
)
from tests.conftest import compare_dataframes


def test_select_l2do_dgen(spark):
    df = spark.createDataFrame(
        [
            ("1", "11", "0CC"),
            ("2", "12", "0CC"),
            ("3", "11", "0CC"),
            ("4", "14", "0CC1"),
            ("5", "15", "0CC1"),
            ("6", "17", "0CC1"),
            ("7", "11", "0CC"),
            ("8", "12", "0CC2"),
        ],
        ["nodoss", "rfemp_11", "entgest_11"],
    )

    actual = select_l2do_dgen(df)

    expected = pd.DataFrame(
        [
            ("1", "11", "0CC"),
            ("2", "12", "0CC"),
            ("3", "11", "0CC"),
            ("4", "14", "0CC1"),
            ("5", "15", "0CC1"),
            ("6", "17", "0CC1"),
            ("7", "11", "0CC"),
            ("8", "12", "0CC2"),
        ],
        columns=["numero_dossier", "numero_de_compte", "entite_gestion"],
    )

    compare_dataframes(actual, expected, sort_by=["numero_dossier"])


def test_select_l2do_dlanc(spark):
    df = spark.createDataFrame(
        [
            (
                "1",
                "a",
                "2024-07-07",
                "ae",
                "1000",
                "1",
                "2024-07-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "2",
                "d",
                "2024-07-08",
                "ae",
                "1000",
                "1",
                "2024-08-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "3",
                "a",
                "2024-07-05",
                "ae",
                "1000",
                "1",
                "2024-09-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "r",
                "c",
                "2024-04-07",
                "ae",
                "1000",
                "1",
                "2024-10-10",
                "2024-11-10",
                "2024-07-10",
                "5",
            ),
        ],
        [
            "nodoss",
            "cdpdt_12",
            "dtpropo_12",
            "cddevise_12",
            "nominal_12",
            "duree_12",
            "dtreal_12",
            "dtech_12",
            "dtaccor_12",
            "tie_12",
        ],
    )
    actual = select_l2do_dlanc(df)

    expected = pd.DataFrame(
        [
            (
                "1",
                "a",
                "2024-07-07",
                "ae",
                "1000",
                "1",
                "2024-07-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "2",
                "d",
                "2024-07-08",
                "ae",
                "1000",
                "1",
                "2024-08-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "3",
                "a",
                "2024-07-05",
                "ae",
                "1000",
                "1",
                "2024-09-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "r",
                "c",
                "2024-04-07",
                "ae",
                "1000",
                "1",
                "2024-10-10",
                "2024-11-10",
                "2024-07-10",
                "5",
            ),
        ],
        columns=[
            "numero_dossier",
            "code_produit",
            "date_proposition",
            "devise_pret",
            "nominal",
            "duree_dossier",
            "date_realisation",
            "date_premiere_echeance",
            "date_accord_dossier",
            "taux_interet_effectif_initial",
        ],
    )

    compare_dataframes(actual, expected, sort_by=["numero_dossier"])


def test_select_l2do_tfonc(spark):
    df = spark.createDataFrame(
        [
            (
                "1",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "3",
            ),
            (
                "2",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "1",
            ),
            (
                "3",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "3",
            ),
            (
                "4",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "33",
            ),
            (
                "5",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "5",
            ),
        ],
        [
            "nodoss",
            "durcfd_22",
            "nbeche_22",
            "nopac_e22",
            "dtfdp_22",
            "dtfdr_22",
            "stdu_22",
            "crdu_22",
            "mttdbl_22",
            "dtaddbl_22",
            "dtddbl_22",
            "dtpdbl_22",
            "mtpdbl_22",
            "camechb_22",
            "ipechb_22",
            "dtadech_22",
            "dtdech_22",
            "nopech_22",
            "mtdblmns_22",
            "dtecmoy_22",
            "mtecmoy_22",
            "dtpechit_22",
            "dtplit_22",
            "dtpctx_22",
            "cvnominal_22",
            "dtrach_22",
            "tie_22",
            "cdsitdos_22",
        ],
    )

    actual = select_l2do_tfonc(df)

    expected = pd.DataFrame(
        [
            (
                "1",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "3",
                "ATTENTE_MODIFCATION_DONNEES_FINANCIERES",
            ),
            (
                "2",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "1",
                "ACCORDE_ATTENTE_REALISATION",
            ),
            (
                "3",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "3",
                "ATTENTE_MODIFCATION_DONNEES_FINANCIERES",
            ),
            (
                "4",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "33",
                None,
            ),
            (
                "5",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "5",
                "SOLDE",
            ),
        ],
        columns=[
            "numero_dossier",
            "duree_restante",
            "nombre_echeance_echues",
            "numero_palier_en_cours",
            "date_fin_previsionnelle",
            "date_fin_reelle",
            "sommes_totales_restant_dues",
            "capital_restant_du",
            "montant_total_debloque_depuis_l_origine",
            "date_avant_dernier_deblocage",
            "date_dernier_deblocage",
            "date_prochain_deblocage",
            "montant_prochain_deblocage",
            "capital_total_amorti_en_echeances",
            "capital_total_recue_en_interets_part_banque",
            "date_avant_derniere_echeance_traitee",
            "date_derniere_echeance",
            "numero_prochain_echeance",
            "montant_debloque_dans_mois_global",
            "date_dernier_calcul_encours_calcule",
            "montant_dernier_encours_calcule",
            "date_prochaine_echeance",
            "date_passage_pret_douteux_compromis",
            "date_passage_contentieux",
            "nominal_en_contre_valeur_devise_nationale",
            "date_rachat",
            "date_anticipation_remboursement_anticipe",
            "taux_interets_effectif_courant",
            "code_situation_dossier",
            "lib_etat_dossier",
        ],
    )
    compare_dataframes(actual, expected, sort_by=["numero_dossier"])


def test_select_l2do_dcomm(spark):
    df = spark.createDataFrame(
        [
            ("1", "a", "cc"),
            ("2", "b", "cc"),
            ("3", "a", "cc"),
            ("4", "c", "cc"),
            ("5", "a", "ct"),
            ("6", "d", "ct"),
        ],
        ["nodoss", "ctdoss_13", "type_pret"],
    )

    actual = select_l2do_dcomm(df)

    expected = pd.DataFrame(
        [
            ("1", "a", "cc"),
            ("2", "b", "cc"),
            ("3", "a", "cc"),
            ("4", "c", "cc"),
            ("5", "a", "ct"),
            ("6", "d", "ct"),
        ],
        columns=["numero_dossier", "code_categorie_pret", "type_pret"],
    )

    compare_dataframes(actual, expected, sort_by=["numero_dossier"])


def test_select_l2do_dpal(spark):
    df = spark.createDataFrame(
        [
            ("1", "01", "a", "cc", "5"),
            ("2", "01", "b", "cc", "5"),
            ("3", "01", "a", "cc", "5"),
            ("4", "01", "c", "cc", "5"),
            ("5", "01", "a", "ct", "5"),
            ("6", "01", "d", "ct", "5"),
        ],
        ["nodoss", "nopal_e18", "mtdebloc_18", "capamort_18", "mtint_18"],
    )

    actual = select_l2do_dpal(df)

    expected = pd.DataFrame(
        [
            ("1", "a", "cc", "5", "a"),
            ("2", "b", "cc", "5", "b"),
            ("3", "a", "cc", "5", "a"),
            ("4", "c", "cc", "5", "c"),
            ("5", "a", "ct", "5", "a"),
            ("6", "d", "ct", "5", "d"),
        ],
        columns=[
            "numero_dossier",
            "montant_deblocage",
            "capital_amortit_palier",
            "interet_a_percevoir",
            "montant_premier_deblocage",
        ],
    )

    compare_dataframes(actual, expected, sort_by=["numero_dossier"])


def test_select_l2hd_rbt_nat(spark):
    df = spark.createDataFrame(
        [
            ("1", "120", "5", "014"),
            ("2", "1200", "5", "014"),
            ("3", "120", "7", "016"),
            ("4", "120", "5", "015"),
            ("5", "120", "5", "015"),
            ("6", "120", "7", "01"),
            ("7", "120", "5", "04"),
        ],
        ["nodoss", "aspb_14", "tvaspb_14", "tyeven_g"],
    )

    actual = select_l2hd_rbt_nat(df)

    expected = pd.DataFrame(
        [
            ("1", "120", "5", "014", "RAT"),
            ("2", "1200", "5", "014", "RAT"),
            ("3", "120", "7", "016", "AUTRE"),
            ("4", "120", "5", "015", "RAP"),
            ("5", "120", "5", "015", "RAP"),
            ("6", "120", "7", "01", "AUTRE"),
            ("7", "120", "5", "04", "AUTRE"),
        ],
        columns=[
            "numero_dossier",
            "montant_rachat",
            "taxe_montant_rachat",
            "tyeven_g",
            "type_rachat",
        ],
    )

    compare_dataframes(actual, expected, sort_by=["numero_dossier"])


def test_build_credit(spark):
    dgen = spark.createDataFrame(
        [
            ("1", "11", "0CC"),
            ("2", "12", "0CC"),
            ("3", "11", "0CC"),
            ("4", "14", "0CC1"),
            ("5", "15", "0CC1"),
            ("6", "17", "0CC1"),
            ("7", "11", "0CC"),
            ("8", "12", "0CC2"),
        ],
        ["nodoss", "rfemp_11", "entgest_11"],
    )

    dlanc = spark.createDataFrame(
        [
            (
                "1",
                "a",
                "2024-07-07",
                "ae",
                "1000",
                "1",
                "2024-07-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "2",
                "d",
                "2024-07-08",
                "ae",
                "1000",
                "1",
                "2024-08-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "3",
                "a",
                "2024-07-05",
                "ae",
                "1000",
                "1",
                "2024-09-10",
                "2024-10-10",
                "2024-07-10",
                "5",
            ),
            (
                "4",
                "c",
                "2024-04-07",
                "ae",
                "1000",
                "1",
                "2024-10-10",
                "2024-11-10",
                "2024-07-10",
                "5",
            ),
        ],
        [
            "nodoss",
            "cdpdt_12",
            "dtpropo_12",
            "cddevise_12",
            "nominal_12",
            "duree_12",
            "dtreal_12",
            "dtech_12",
            "dtaccor_12",
            "tie_12",
        ],
    )

    tfonc = spark.createDataFrame(
        [
            (
                "1",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "3",
            ),
            (
                "2",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "1",
            ),
            (
                "3",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "3",
            ),
            (
                "4",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "33",
            ),
            (
                "5",
                "5",
                "6",
                "a",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "2024-07-07",
                "5",
            ),
        ],
        [
            "nodoss",
            "durcfd_22",
            "nbeche_22",
            "nopac_e22",
            "dtfdp_22",
            "dtfdr_22",
            "stdu_22",
            "crdu_22",
            "mttdbl_22",
            "dtaddbl_22",
            "dtddbl_22",
            "dtpdbl_22",
            "mtpdbl_22",
            "camechb_22",
            "ipechb_22",
            "dtadech_22",
            "dtdech_22",
            "nopech_22",
            "mtdblmns_22",
            "dtecmoy_22",
            "mtecmoy_22",
            "dtpechit_22",
            "dtplit_22",
            "dtpctx_22",
            "cvnominal_22",
            "dtrach_22",
            "tie_22",
            "cdsitdos_22",
        ],
    )

    dcomm = spark.createDataFrame(
        [
            ("1", "a", "cc"),
            ("2", "b", "cc"),
            ("3", "a", "cc"),
            ("4", "c", "cc"),
            ("5", "a", "ct"),
            ("6", "d", "ct"),
        ],
        ["nodoss", "ctdoss_13", "type_pret"],
    )

    dpal = spark.createDataFrame(
        [
            ("1", "01", "1000", "cc", "5"),
            ("2", "01", "1000", "cc", "5"),
            ("3", "01", "1000", "cc", "5"),
            ("4", "01", "1", "cc", "5"),
            ("5", "01", "a", "ct", "5"),
            ("6", "01", "d", "ct", "5"),
        ],
        ["nodoss", "nopal_e18", "mtdebloc_18", "capamort_18", "mtint_18"],
    )

    rbt_nat = spark.createDataFrame(
        [
            ("1", "120", "5", "014"),
            ("2", "1200", "5", "014"),
            ("3", "120", "7", "016"),
            ("4", "120", "5", "015"),
            ("5", "120", "5", "015"),
            ("6", "120", "7", "01"),
            ("7", "120", "5", "04"),
        ],
        ["nodoss", "aspb_14", "tvaspb_14", "tyeven_g"],
    )

    actual = build_credit(dgen, dlanc, tfonc, dcomm, dpal, rbt_nat)

    expected = pd.DataFrame(
        [
            (
                "1",
                "11",
                "a",
                "1000",
                "0CC",
                "a",
                "2024-07-07",
                "ae",
                "1000",
                "1",
                "2024-07-10",
                "2024-10-10",
                "2024-07-10",
                "5",
                "5",
                "6",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "3",
                "ATTENTE_MODIFCATION_DONNEES_FINANCIERES",
                "a",
                "cc",
                "1000",
                "cc",
                "5",
                "120",
                "5",
                "014",
                "RAT",
                "DEBLOCAGE TOTAL",
            ),
            (
                "2",
                "12",
                "a",
                "1000",
                "0CC",
                "d",
                "2024-07-08",
                "ae",
                "1000",
                "1",
                "2024-08-10",
                "2024-10-10",
                "2024-07-10",
                "5",
                "5",
                "6",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "1",
                "ACCORDE_ATTENTE_REALISATION",
                "b",
                "cc",
                "1000",
                "cc",
                "5",
                "1200",
                "5",
                "014",
                "RAT",
                "DEBLOCAGE TOTAL",
            ),
            (
                "3",
                "11",
                "a",
                "1000",
                "0CC",
                "a",
                "2024-07-05",
                "ae",
                "1000",
                "1",
                "2024-09-10",
                "2024-10-10",
                "2024-07-10",
                "5",
                "5",
                "6",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "3",
                "ATTENTE_MODIFCATION_DONNEES_FINANCIERES",
                "a",
                "cc",
                "1000",
                "cc",
                "5",
                "120",
                "7",
                "016",
                "AUTRE",
                "DEBLOCAGE TOTAL",
            ),
            (
                "4",
                "14",
                "a",
                "1",
                "0CC1",
                "c",
                "2024-04-07",
                "ae",
                "1000",
                "1",
                "2024-10-10",
                "2024-11-10",
                "2024-07-10",
                "5",
                "5",
                "6",
                "2024-07-07",
                "2024-07-07",
                "1000",
                "1000",
                "2000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "2000",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "7",
                "1000",
                "2024-07-07",
                "1000",
                "2024-07-07",
                "2024-07-07",
                "2024-07-07",
                "154",
                "121",
                "1000",
                "1000",
                "2024-07-07",
                "33",
                None,
                "c",
                "cc",
                "1",
                "cc",
                "5",
                "120",
                "5",
                "015",
                "RAP",
                "DEBLOCAGE_PARTIEL",
            ),
        ],
        columns=[
            "numero_dossier",
            "numero_de_compte",
            "numero_palier_en_cours",
            "montant_premier_deblocage",
            "entite_gestion",
            "code_produit",
            "date_proposition",
            "devise_pret",
            "nominal",
            "duree_dossier",
            "date_realisation",
            "date_premiere_echeance",
            "date_accord_dossier",
            "taux_interet_effectif_initial",
            "duree_restante",
            "nombre_echeance_echues",
            "date_fin_previsionnelle",
            "date_fin_reelle",
            "sommes_totales_restant_dues",
            "capital_restant_du",
            "montant_total_debloque_depuis_l_origine",
            "date_avant_dernier_deblocage",
            "date_dernier_deblocage",
            "date_prochain_deblocage",
            "montant_prochain_deblocage",
            "capital_total_amorti_en_echeances",
            "capital_total_recue_en_interets_part_banque",
            "date_avant_derniere_echeance_traitee",
            "date_derniere_echeance",
            "numero_prochain_echeance",
            "montant_debloque_dans_mois_global",
            "date_dernier_calcul_encours_calcule",
            "montant_dernier_encours_calcule",
            "date_prochaine_echeance",
            "date_passage_pret_douteux_compromis",
            "date_passage_contentieux",
            "nominal_en_contre_valeur_devise_nationale",
            "date_rachat",
            "date_anticipation_remboursement_anticipe",
            "taux_interets_effectif_courant",
            "code_situation_dossier",
            "lib_etat_dossier",
            "code_categorie_pret",
            "type_pret",
            "montant_deblocage",
            "capital_amortit_palier",
            "interet_a_percevoir",
            "montant_rachat",
            "taxe_montant_rachat",
            "tyeven_g",
            "type_rachat",
            "type_deblocage",
        ],
    )

    compare_dataframes(actual, expected, sort_by=["numero_dossier"])
